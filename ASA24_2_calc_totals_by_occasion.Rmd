---
title: "ASA24 Calculate totals by occation"
output: html_document
---

Name the path to DietR directory where input files are pulled.
```{r}
  main_wd <- "~/GitHub/DietR"
```

Load the necessary functions.
```{r}
  source("lib/specify_data_dir.R")
  source("lib/calc_ASA24totals_by_occasion.R")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_knit$set(root.dir = 'eg_data/VVKAJ')
```

<br>

### Load ASA24 Items data that has been formatted

Specify the directory where the data is.
```{r, eval = FALSE}
  SpecifyDataDirectory(directory.name= "eg_data/VVKAJ/")
```
<!-- [NOTE] SpecifyDataDirectory function is not executed by R markdown, but just showing  -->
<!--  the code so that this tutorial will have the same code as the R script.  -->

Load the formatted items data.
```{r}
  items_f_id_s_m <- read.table("VVKAJ_Items_f_id_s_m.txt", sep = "\t", header=T)
```

<br>

### Generate sum of foods consumed by each user, by day, and by occasion

Calculate sum of nutrients and food categories of items by user and by occasion; output will be saved as: `Items_by_User_Occ`.
```{r}
  SumByOccasion(items.data=items_f_id_s_m, User.Name='UserName', 
                  Recall.No='RecallNo',   Occ.No='Occ_No')
```

Take a look at the first 10 rows of the first 6 columns.
Items are summed by occasion number for each participant's RecallNo. 
```{r}
  Items_by_User_Occ[1:10, 1:6]
```

Use `Items_by_User_Occ` and add occasion names (breakfast, snacks etc.) to it; output will be saved as: `Sum_by_User_Day_Occ`.
```{r}
  AddOccNames(items.data=items_f_id_s_m, User.Name='UserName', 
                Recall.No='RecallNo', Occ.No='Occ_No', Occ.Name='Occ_Name'  )
```

Take a look at the first 6 rows. Spelled-out occasion names corresponding to occasion name have been added at the end.
```{r, eval=FALSE}
  head(Sum_by_User_Day_Occ)
```

<details>
  <summary>Click to expand output</summary>
```{r, echo=FALSE, eval=TRUE}
head(Sum_by_User_Day_Occ)
```
</details>

<br>

Save `Sum_by_User_Day_Occ` as a txt file.
```{r}
  write.table(Sum_by_User_Day_Occ, 'VVKAJ_Sum_by_User_Day_Occ.txt', sep="\t", row.names=F, quote=F)
```

This will be useful if a researcher wants to look at the sum of each eating occasion 
per participant. (Because Totals file sums all the occasions as one day)

<br>

---
  
Come back to the main directory before you start running another script.
```{r, eval=FALSE}
  setwd(main_wd)
```
  



