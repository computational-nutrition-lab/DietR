---
title: "PCA results"
output: html_document
---

Here, we will color-code the datapoints in PCA biplots by a desired variable in the metadata to facilitate understanding of clustering of the individuals.

<br>

Name the path to DietR directory where input files are pulled.
```{r}
  main_wd <- "~/GitHub/DietR"
```

Load the necessary packages.
```{r}
  library(ggplot2)
```


Load the necessary functions
```{r}
  source("lib/specify_data_dir.R")
  source("lib/ggplot2themes.R")
```

Call color palette.
```{r}
  distinct100colors <- readRDS("lib/distinct100colors.rda")
```

You can come back to the main directory by:
```{r, eval=FALSE}
  setwd(main_wd)
```

<br>

### Nutrients results 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_knit$set(root.dir = 'eg_data/VVKAJ/PCA_Nut_asis')
```

Specify the directory where the data is.
```{r, eval = FALSE}
  SpecifyDataDirectory(directory.name= "eg_data/VVKAJ/PCA_Nut_asis")
```
<!-- [NOTE] SpecifyDataDirectory function is not executed by R markdown, but just showing  -->
<!--  the code so that this tutorial will have the same code as the R script.  -->


Load the PCA result.
```{r}
  pcares <- read.table("VVKAJ_Nut_asis_PCs.txt", sep="\t", header=T)
```

```{r, eval=FALSE}
  head(pcares, 1)
```

<details>
  <summary>Click to expand output</summary>
```{r, echo=FALSE, eval=TRUE}
head(pcares, 1)
```
</details>

<br>

PCA results contains the input (UserNames, nutrients, food categories), metadata (Diet, Gender etc.), and corresponding PC axis values.

<br>

Load the variance explained by each PC.
```{r}
  PC_var_exp <- read.table("VVKAJ_Nut_asis_PC_var_explained.txt", sep="\t", header=T)
```

```{r}
  head(PC_var_exp)
```

<br>

---

Generate a PC1 x PC2 plot with the users colored by their diets.
```{r}
  PC12_diet <- ggplot(pcares, aes(x=PC1, y=PC2, color=Diet, fill=Diet)) + 
    geom_point(size=3) +
    no_grid + space_axes +
    scale_fill_manual( values = distinct100colors) +
    scale_color_manual(values = distinct100colors) +
    scale_x_continuous(expand = expansion(mult=c(0.1, 0.1))) + # give some space on the lower and the upper limits of X.
    scale_y_continuous(expand = expansion(mult=c(0.1, 0.1))) + # give some space on the lower and the upper limits of Y.
    labs(x = paste("PC1 (", round(PC_var_exp[1,2]*100, 1), "%)", sep=""),  
         y = paste("PC2 (", round(PC_var_exp[2,2]*100, 1), "%)", sep="")) +
    theme(aspect.ratio = 1)
```


```{r}
  PC12_diet
```

Save as a .pdf.
```{r}
  ggsave("VVKAJ_Nut_asis_PC12_diet.pdf", PC12_diet, 
         device="pdf", width=7, height=6.5)
```

Similar charts can be generated using the PCA results of Nut_ave, Cat_asis, and Cat_ave by loading their PCA output.

<br>

---

Come back to the main directory before you start running another script.
```{r, eval=FALSE}
  setwd(main_wd)
```
  
