<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Load and clean NHANES data - 2</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DietR Package</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    ASA24
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ASA24_1.html">Load and clean ASA24 data</a>
    </li>
    <li>
      <a href="ASA24_2.html">Calculate totals by occasion</a>
    </li>
    <li>
      <a href="ASA24_3.html">Data overview</a>
    </li>
    <li>
      <a href="ASA24_4.html">Percent kcal of CARB, PROT, TFAT</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="ASA24_5.html">Prepare for clustering</a>
    </li>
    <li>
      <a href="ASA24_6_PCA.html">PCA</a>
    </li>
    <li>
      <a href="ASA24_7_PCA_results.html">PCA results</a>
    </li>
    <li>
      <a href="ASA24_8_k-means.html">K-means</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="ASA24_9_create_food_tree.html">Create food tree</a>
    </li>
    <li>
      <a href="ASA24_10_viz_food_tree.html">Visualize food tree</a>
    </li>
    <li>
      <a href="ASA24_11_ordination.html">Ordination</a>
    </li>
    <li>
      <a href="ASA24_12_viz_ordination.html">Visualize ordination</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    NHANES
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="NHANES_1_load_and_clean_1.html">Load and clean NHANES data - 1</a>
    </li>
    <li>
      <a href="NHANES_2_load_and_clean_2.html">Load and clean NHANES data - 2</a>
    </li>
    <li>
      <a href="NHANES_3_data_overview.html">Data overview</a>
    </li>
    <li>
      <a href="NHANES_4_percent_kcal.html">Percent kcal of CARB, PROT, TFAT</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Load and clean NHANES data - 2</h1>

</div>


<p>Name the path to DietR directory where input files are pulled.</p>
<pre class="r"><code>  main_wd &lt;- &quot;~/GitHub/DietR&quot;</code></pre>
<p>Load the necessary packages.</p>
<pre class="r"><code>library(SASxport)</code></pre>
<p>Load the necessary functions.</p>
<pre class="r"><code>  source(&quot;lib/specify_data_dir.R&quot;)
  source(&quot;lib/load_clean_NHANES.R&quot;)
  source(&quot;lib/load_clean_ASA24.R&quot;)</code></pre>
<p>You can come back to the main directory by:</p>
<pre class="r"><code>  setwd(main_wd)</code></pre>
<p><br></p>
<div id="qc-the-formatted-food-data-by-their-demographics-data" class="section level2">
<h2>QC the formatted food data by their demographics data</h2>
<div id="download-and-prepare-demographics-data" class="section level3">
<h3>Download and prepare demographics data</h3>
<p>Download demographics data (DEMO_I.XPT) from NHANES website. Name the file and destination. <code>mod="wb"</code> is needed for Windows OS; other OS users may need to delete it.</p>
<pre class="r"><code>download.file(&quot;https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DEMO_I.XPT&quot;, 
              destfile= &quot;eg_data/NHANES/DR1IFF_I.XPT&quot;, mode=&quot;wb&quot;)</code></pre>
<p>Load the demographics file.</p>
<pre class="r"><code>demog &lt;- read.xport(&quot;eg_data/NHANES/Raw_data/DEMO_I.XPT&quot;)</code></pre>
<p>Demographics data has the age, gender, etc. of each participant. Read <a href="https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DEMO_I.htm">the documentation on demographics</a> for details.</p>
<pre class="r"><code>head(demog, 1)</code></pre>
<pre><code>##    SEQN SDDSRVYR RIDSTATR RIAGENDR RIDAGEYR RIDAGEMN RIDRETH1 RIDRETH3 RIDEXMON
## 1 83732        9        2        1       62       NA        3        3        1
##   RIDEXAGM DMQMILIZ DMQADFC DMDBORN4 DMDCITZN DMDYRSUS DMDEDUC3 DMDEDUC2
## 1       NA        2      NA        1        1       NA       NA        5
##   DMDMARTL RIDEXPRG SIALANG SIAPROXY SIAINTRP FIALANG FIAPROXY FIAINTRP MIALANG
## 1        1       NA       1        2        2       1        2        2       1
##   MIAPROXY MIAINTRP AIALANGA DMDHHSIZ DMDFMSIZ DMDHHSZA DMDHHSZB DMDHHSZE
## 1        2        2        1        2        2        0        0        1
##   DMDHRGND DMDHRAGE DMDHRBR4 DMDHREDU DMDHRMAR DMDHSEDU WTINT2YR WTMEC2YR
## 1        1       62        1        5        1        3 134671.4 135629.5
##   SDMVPSU SDMVSTRA INDHHIN2 INDFMIN2 INDFMPIR
## 1       1      125       10       10     4.39</code></pre>
<p>Only take the data of adults (18 years of age or older).</p>
<pre class="r"><code>adults &lt;- demog[demog$RIDAGEYR &gt;= 18, ]</code></pre>
<p>Check the number of adults - should be 5,992.</p>
<pre class="r"><code>length(unique(adults$SEQN)) </code></pre>
<pre><code>## [1] 5992</code></pre>
<p><br></p>
</div>
<div id="load-the-formatted-food-items-data-and-filter-by-age-completeness-1-food-item-reportedday-data-exists-on-both-days" class="section level3">
<h3>Load the formatted food items data and filter by age, completeness, &gt;1 food item reported/day, data exists on both days</h3>
<p>Load the formatted food data prepared in the previous section.</p>
<pre class="r"><code>Food_D1_FC_cc_f &lt;- read.table(&quot;eg_data/NHANES/Food_D1_FC_cc_f.txt&quot;, sep=&quot;\t&quot;, header=T)
Food_D2_FC_cc_f &lt;- read.table(&quot;eg_data/NHANES/Food_D2_FC_cc_f.txt&quot;, sep=&quot;\t&quot;, header=T)</code></pre>
<p>Check the number of complete and incomplete data or each day. According to <a href="https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DR1IFF_I.htm">the documentation on food items</a>, value 4 is incomplete. By looking at the DRxDRSTZ column, 2,208 rows are marked incomplete for Day 1, and 1,902 rows for Day 2.</p>
<pre class="r"><code>table(Food_D1_FC_cc_f$DR1DRSTZ) # Day 1</code></pre>
<pre><code>## 
##      1      4 
## 119273   2208</code></pre>
<pre class="r"><code>table(Food_D2_FC_cc_f$DR2DRSTZ) # Day 2</code></pre>
<pre><code>## 
##     1     4 
## 98778  1902</code></pre>
<p>Subset only those with complete data (STZ==1).</p>
<pre class="r"><code>food1 &lt;- subset(Food_D1_FC_cc_f, DR1DRSTZ == 1)
food2 &lt;- subset(Food_D2_FC_cc_f, DR2DRSTZ == 1)</code></pre>
<p>Create a vector of SEQN of those who reported data for both days and are adults.</p>
<pre class="r"><code>food1names &lt;- unique(food1$SEQN) # 8,326 adults
food2names &lt;- unique(food2$SEQN) # 6,875 adults
keepnames &lt;- food1names[food1names %in% food2names]  # 6,863
keepnames_adults &lt;- keepnames[keepnames %in% adults$SEQN] # 4,405</code></pre>
<p>Keep those who reported more than 1 food item per day.</p>
<pre class="r"><code>freqtable1 &lt;- as.data.frame(table(food1$SEQN))
freqtable1_m &lt;- freqtable1[freqtable1$Freq &gt; 1, ]
colnames(freqtable1_m)[1] &lt;- &quot;SEQN&quot;
keepnames_adults_mult1 &lt;- keepnames_adults[keepnames_adults %in% freqtable1_m$SEQN] # 4,405</code></pre>
<p>Take only the participants whose names are in keepnames_adults_mult1.</p>
<pre class="r"><code>food1b &lt;- food1[food1$SEQN %in% keepnames_adults_mult1, ] # 66,304 rows</code></pre>
<p>Do the same for food2.</p>
<pre class="r"><code>freqtable2 &lt;- as.data.frame(table(food2$SEQN))
freqtable2_m &lt;- freqtable2[freqtable2$Freq &gt; 1, ]
colnames(freqtable2_m)[1] &lt;- &quot;SEQN&quot;
keepnames_adults_mult2 &lt;- keepnames_adults[keepnames_adults %in% freqtable2_m$SEQN] # 4,401
food2b &lt;- food2[food2$SEQN %in% keepnames_adults_mult2, ] # 66,690 rows</code></pre>
<p>Create a vector of SEQN of those that have both day 1 and day 2 data.</p>
<pre class="r"><code>food1bnames &lt;- unique(food1b$SEQN)
food2bnames &lt;- unique(food2b$SEQN)
keepnames12 &lt;- food1bnames[food1bnames %in% food2bnames] </code></pre>
<p>Check the number of participants remained. 4,401 people met the criteria.</p>
<pre class="r"><code>length(keepnames12)</code></pre>
<pre><code>## [1] 4401</code></pre>
<p><br></p>
</div>
</div>
<div id="prepare-food-data-for-food-tree-and-generate-totals" class="section level2">
<h2>Prepare food data for food tree and generate totals</h2>
<p>Choose Scenario A or B. (B consists of B-1, B-2, B-3, and B-4.)<br />
<strong>Scenario A</strong>: Further process food1b and food2b for building a food tree<br />
<strong>Scenario B-1-4</strong>: Calculate totals from the QC-ed food items and QC totals<br />
</p>
<div id="scenario-a-further-process-food1b-and-food2b-for-building-a-food-tree" class="section level3">
<h3><strong>Scenario A</strong>: Further process food1b and food2b for building a food tree</h3>
<p>Make a day variable to distinguish them.</p>
<pre class="r"><code>food1b$Day &lt;- 1
food2b$Day &lt;- 2</code></pre>
<p>Copy these datasets to avoid overwriting.</p>
<pre class="r"><code>food1e &lt;- food1b
food2e &lt;- food2b</code></pre>
<p>Remove the prefixes “DR1I”, “DR1” from the columnnames.</p>
<pre class="r"><code>colnames(food1e) &lt;- gsub(colnames(food1e), pattern = &quot;^DR1I&quot;, replacement = &quot;&quot;)
colnames(food1e) &lt;- gsub(colnames(food1e), pattern = &quot;^DR1&quot;,  replacement = &quot;&quot;)
colnames(food2e) &lt;- gsub(colnames(food2e), pattern = &quot;^DR2I&quot;, replacement = &quot;&quot;)
colnames(food2e) &lt;- gsub(colnames(food2e), pattern = &quot;^DR2&quot;,  replacement = &quot;&quot;)</code></pre>
<p>Ensure the columns of food1c and food2c match before joining them.</p>
<pre class="r"><code>identical(colnames(food1e), colnames(food2e))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Combine food1 and food2 as a longtable (add food2 rows after food1 rows).</p>
<pre class="r"><code>food12e &lt;- rbind(food1e, food2e)</code></pre>
<p>Select only the individuals listed in keepnames12.</p>
<pre class="r"><code>food12f &lt;- food12e[food12e$SEQN %in% keepnames12, ]</code></pre>
<p>Save as a .txt. It will be a HUGE file. Use this as an input for <strong>food tree</strong>.</p>
<pre class="r"><code>write.table(food12f, &quot;eg_data/NHANES/Food_D12_FC_cc_f_s.txt&quot;, sep=&quot;\t&quot;, row.names=F, quote=F)</code></pre>
<p>Add the demographic data to food12f for data overview.</p>
<pre class="r"><code>food12f_d &lt;- merge(x=food12f, y=demog, by=&quot;SEQN&quot;, all.x=T)</code></pre>
<p>Save. It will be a HUGE file. Use this as an input for <strong>data overview</strong>.</p>
<pre class="r"><code>write.table(food12f_d, &quot;eg_data/NHANES/Food_D12_FC_cc_f_s_d.txt&quot;, sep=&quot;\t&quot;, row.names=F, quote=F)</code></pre>
<p><br></p>
</div>
<div id="scenario-b-1-4-calculate-totals-from-the-qc-ed-food-items-and-qc-totals" class="section level3">
<h3><strong>Scenario B-1-4</strong>: Calculate totals from the QC-ed food items and QC totals</h3>
<div id="scenario-b-1-further-processing-of-food1b-and-food2b-for-calculating-totals-and-clustering" class="section level4">
<h4>Scenario B-1: Further processing of food1b and food2b for calculating totals and clustering</h4>
<p>Copy datasets to avoid overwriting.</p>
<pre class="r"><code>food1bb &lt;- food1b
food2bb &lt;- food2b</code></pre>
<p>Change “FoodAmt” back to “DR1GRMS” to be consistent with the variable names in dayXvariables</p>
<pre class="r"><code>names(food1bb)[names(food1bb) == &quot;FoodAmt&quot;] &lt;- &quot;DR1IGRMS&quot;
names(food2bb)[names(food2bb) == &quot;FoodAmt&quot;] &lt;- &quot;DR2IGRMS&quot;</code></pre>
<p><strong>[NOTE]</strong> Prepare data to combine day 1 and day 2 data.</p>
<p>Appendix 2 of <a href="https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DRXFCD_I.htm#Appendix_2._Variables_in_the_Individual_Foods_Files_(DR1IFF_I_and_DR2IFF_I)_by_Position">food data documentation</a> shows the variables in the Individual Foods Files (DR1IFF_I and DR2IFF_I).</p>
<p><img src="images/NHANES_01/Load_Scenario%20B-1%20Appendix%202.jpg" /></p>
<p>However, we need food category information as well, similar to ASA24. Food category variables (Food Patterns Equivalents Database per 100 grams of FNDDS) can be found in <a href="https://www.ars.usda.gov/northeast-area/beltsville-md-bhnrc/beltsville-human-nutrition-research-center/food-surveys-research-group/docs/fped-databases/">the FPED page</a>. Select the same years of FPED as your NHANES release you are using. The variable labels (F_CITMLB through A_DRINKS, for FPED 2015-2016) are the food category variables you need.</p>
<div class="figure" style="text-align: left">
<img src="images/NHANES_01/Load_Scenario%20B-1%20FPED_1516.jpg" alt="The first few lines of FPED_1516.xls" width="60%" />
<p class="caption">
The first few lines of FPED_1516.xls
</p>
</div>
<p>If you are analyzing NHANES 2015-2016, this tutorial provides you with a .txt file with the necessary variable names that can be found in the “Food_VarNames” folder. If you are analyzing other releases of NHANES, create an Excel workbook, and copy and paste the variables from the Appendix of the documentation of the selected version of NHANES and food category variables from the appropriate version of FPED.</p>
<p>Those two sets of variables need to come one after another vertically, so that they will form a long list of variables, for which we would like to calculate totals from the food data.</p>
<p><br></p>
<hr />
<p>Import the list of variables to be selected in Day 1.</p>
<pre class="r"><code>day1variables &lt;- read.table(&#39;eg_data/NHANES/Food_VarNames/NHANES_Food_VarNames_FC_Day1.txt&#39;, header=F)</code></pre>
<p>Select the variables to pick up from the food data.</p>
<pre class="r"><code>var_to_use1 &lt;- names(food1bb) %in% day1variables$V1</code></pre>
<p>Pick up only the specified variables.</p>
<pre class="r"><code>food1c &lt;- food1bb[, var_to_use1]</code></pre>
<p>Remove “DR1T”, “DR1” from the column names.</p>
<pre class="r"><code>colnames(food1c) &lt;- gsub(colnames(food1c), pattern = &quot;^DR1I&quot;, replacement = &quot;&quot;)
colnames(food1c) &lt;- gsub(colnames(food1c), pattern = &quot;^DR1&quot;,  replacement = &quot;&quot;)</code></pre>
<p>Check the column names.</p>
<pre class="r"><code>colnames(food1c)</code></pre>
<details>
<summary>
Click to expand output
</summary>
<pre><code>##   [1] &quot;SEQN&quot;             &quot;GRMS&quot;             &quot;KCAL&quot;            
##   [4] &quot;PROT&quot;             &quot;CARB&quot;             &quot;SUGR&quot;            
##   [7] &quot;FIBE&quot;             &quot;TFAT&quot;             &quot;SFAT&quot;            
##  [10] &quot;MFAT&quot;             &quot;PFAT&quot;             &quot;CHOL&quot;            
##  [13] &quot;ATOC&quot;             &quot;ATOA&quot;             &quot;RET&quot;             
##  [16] &quot;VARA&quot;             &quot;ACAR&quot;             &quot;BCAR&quot;            
##  [19] &quot;CRYP&quot;             &quot;LYCO&quot;             &quot;LZ&quot;              
##  [22] &quot;VB1&quot;              &quot;VB2&quot;              &quot;NIAC&quot;            
##  [25] &quot;VB6&quot;              &quot;FOLA&quot;             &quot;FA&quot;              
##  [28] &quot;FF&quot;               &quot;FDFE&quot;             &quot;CHL&quot;             
##  [31] &quot;VB12&quot;             &quot;B12A&quot;             &quot;VC&quot;              
##  [34] &quot;VD&quot;               &quot;VK&quot;               &quot;CALC&quot;            
##  [37] &quot;PHOS&quot;             &quot;MAGN&quot;             &quot;IRON&quot;            
##  [40] &quot;ZINC&quot;             &quot;COPP&quot;             &quot;SODI&quot;            
##  [43] &quot;POTA&quot;             &quot;SELE&quot;             &quot;CAFF&quot;            
##  [46] &quot;THEO&quot;             &quot;ALCO&quot;             &quot;MOIS&quot;            
##  [49] &quot;S040&quot;             &quot;S060&quot;             &quot;S080&quot;            
##  [52] &quot;S100&quot;             &quot;S120&quot;             &quot;S140&quot;            
##  [55] &quot;S160&quot;             &quot;S180&quot;             &quot;M161&quot;            
##  [58] &quot;M181&quot;             &quot;M201&quot;             &quot;M221&quot;            
##  [61] &quot;P182&quot;             &quot;P183&quot;             &quot;P184&quot;            
##  [64] &quot;P204&quot;             &quot;P205&quot;             &quot;P225&quot;            
##  [67] &quot;P226&quot;             &quot;F_CITMLB&quot;         &quot;F_OTHER&quot;         
##  [70] &quot;F_JUICE&quot;          &quot;F_TOTAL&quot;          &quot;V_DRKGR&quot;         
##  [73] &quot;V_REDOR_TOMATO&quot;   &quot;V_REDOR_OTHER&quot;    &quot;V_REDOR_TOTAL&quot;   
##  [76] &quot;V_STARCHY_POTATO&quot; &quot;V_STARCHY_OTHER&quot;  &quot;V_STARCHY_TOTAL&quot; 
##  [79] &quot;V_OTHER&quot;          &quot;V_TOTAL&quot;          &quot;V_LEGUMES&quot;       
##  [82] &quot;G_WHOLE&quot;          &quot;G_REFINED&quot;        &quot;G_TOTAL&quot;         
##  [85] &quot;PF_MEAT&quot;          &quot;PF_CUREDMEAT&quot;     &quot;PF_ORGAN&quot;        
##  [88] &quot;PF_POULT&quot;         &quot;PF_SEAFD_HI&quot;      &quot;PF_SEAFD_LOW&quot;    
##  [91] &quot;PF_MPS_TOTAL&quot;     &quot;PF_EGGS&quot;          &quot;PF_SOY&quot;          
##  [94] &quot;PF_NUTSDS&quot;        &quot;PF_LEGUMES&quot;       &quot;PF_TOTAL&quot;        
##  [97] &quot;D_MILK&quot;           &quot;D_YOGURT&quot;         &quot;D_CHEESE&quot;        
## [100] &quot;D_TOTAL&quot;          &quot;OILS&quot;             &quot;SOLID_FATS&quot;      
## [103] &quot;ADD_SUGARS&quot;       &quot;A_DRINKS&quot;</code></pre>
</details>
<p><br></p>
<hr />
<p>Do the same for Day 2.</p>
<pre class="r"><code>day2variables &lt;- read.table(&#39;eg_data/NHANES/Food_VarNames/NHANES_Food_VarNames_FC_Day2.txt&#39;, header=F)
var_to_use2 &lt;- names(food2bb) %in% day2variables$V1
food2c &lt;- food2bb[, var_to_use2]
colnames(food2c) &lt;- gsub(colnames(food2c), pattern = &quot;^DR2I&quot;, replacement = &quot;&quot;)
colnames(food2c) &lt;- gsub(colnames(food2c), pattern = &quot;^DR2&quot;, replacement = &quot;&quot;)</code></pre>
<p>Make a day variable before combining food1c and food2c.</p>
<pre class="r"><code>food1c$Day &lt;- 1
food2c$Day &lt;- 2</code></pre>
<p>Ensure the columns of food1c and food2c match before joining them.</p>
<pre class="r"><code>identical(colnames(food1c), colnames(food2c))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>If not, create a table that has the column names of both food1c and food2c, examine the column names side-by-side.</p>
<pre class="r"><code>names &lt;- data.frame(matrix(nrow= max(ncol(food1c), ncol(food2c)), ncol=2))
colnames(names) &lt;- c(&quot;food1c&quot;, &quot;food2c&quot;)
names$food1c &lt;- colnames(food1c)
names$food2c &lt;- colnames(food2c)
names</code></pre>
<p>Combine food1 and food2 as a longtable.</p>
<pre class="r"><code>food12c &lt;- rbind(food1c, food2c)</code></pre>
<p>Pick up only the individuals listed in keepnames12.</p>
<pre class="r"><code>food12d &lt;- food12c[food12c$SEQN %in% keepnames12, ]</code></pre>
<p>Save the combined and QC-ed food items as a .txt file. This has nutrient information, food categories, and day variable for each food item reported, and shall be used to calculate totals in B-2. *** THIS WILL BE A HUGE FILE. ***</p>
<pre class="r"><code>write.table(food12d, &quot;eg_data/NHANES/Food_D12_FC_QC.txt&quot;, sep=&quot;\t&quot;, quote=F, row.names=F)  </code></pre>
<hr />
<p>You may also want to consider special diets that some participants are following: e.g. DASH diet, diabetic diet, etc. Depending on your research question, you may want to exclude those following special diets. The diet information is found in totals day 1. We will revisit diet information in the next section.</p>
<p><br></p>
</div>
<div id="b-2-calculate-totalsdayparticipant-with-the-food-data-of-the-selected-seqn" class="section level4">
<h4>B-2: Calculate totals/day/participant with the food data of the selected SEQN</h4>
<p>Load the QC-ed food items.</p>
<pre class="r"><code>food12d &lt;- read.table(&quot;eg_data/NHANES/Food_D12_FC_QC.txt&quot;, sep=&quot;\t&quot;, header=T)</code></pre>
<p>Calculate totals for day 1 and day 2, and combine the two datasets.</p>
<pre class="r"><code>  TotalNHANES(food12d= food12d, 
              first.val= &quot;GRMS&quot;, last.val= &quot;A_DRINKS&quot;, 
              outfn= &quot;eg_data/NHANES/Total_D12_FC_QC_eachday.txt&quot;) </code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Load the resultant total.</p>
<pre class="r"><code>total12d &lt;- read.table(&quot;eg_data/NHANES/Total_D12_FC_QC_eachday.txt&quot;, sep=&quot;\t&quot;, header=T)</code></pre>
<p><code>total12d</code> has the sum of each variable (columns) for each day and participant.</p>
<pre class="r"><code>head(total12d, 2)</code></pre>
<details>
<summary>
Click to expand output
</summary>
<pre><code>##    SEQN    GRMS KCAL  PROT   CARB   SUGR FIBE  TFAT   SFAT   MFAT   PFAT CHOL
## 1 83732 3399.99 1781 76.03 193.29  42.31 23.6 79.24 23.430 31.897 18.528  138
## 2 83733 4630.72 2964 62.36 356.85 180.84  7.3 77.91 25.722 19.098 19.216  407
##    ATOC ATOA RET VARA ACAR BCAR CRYP LYCO   LZ   VB1   VB2   NIAC   VB6 FOLA
## 1 10.59    0 230  307  336  624  282 1206 1120 2.344 1.949 20.401 2.279  450
## 2  4.19    0 352  453  405  966   20    0 1279 1.859 2.478 29.444 1.823  478
##    FA  FF FDFE   CHL VB12 B12A    VC  VD    VK CALC PHOS MAGN  IRON ZINC  COPP
## 1 163 286  564 290.7 1.89    0 110.5 2.6 139.0  623 1052  255 16.01 8.73 1.095
## 2 112 365  556 672.7 2.92    0  30.2 4.6  87.6  594 1414  262 11.01 4.82 0.571
##   SODI POTA  SELE CAFF THEO ALCO    MOIS  S040  S060  S080  S100  S120  S140
## 1 5298 2641 113.6  360    0  0.0 3028.29 0.013 0.010 0.053 0.092 0.365 1.271
## 2 3164 2249  89.9  192    0 89.3 4024.25 0.563 0.441 0.275 0.764 0.863 2.688
##     S160  S180  M161   M181  M201  M221   P182  P183  P184  P204  P205  P225
## 1 13.199 7.334 1.585 28.937 0.332 0.276 16.024 2.294 0.004 0.110 0.004 0.017
## 2 13.234 6.144 0.693 17.837 0.155 0.000 16.712 2.140 0.000 0.206 0.005 0.026
##    P226 F_CITMLB F_OTHER F_JUICE F_TOTAL V_DRKGR V_REDOR_TOMATO V_REDOR_OTHER
## 1 0.002   1.0368       0       0  1.0368       0          0.058      0.000000
## 2 0.036   0.0000       0       0  0.0000       0          0.000      0.086233
##   V_REDOR_TOTAL V_STARCHY_POTATO V_STARCHY_OTHER V_STARCHY_TOTAL  V_OTHER
## 1      0.058000                0               0               0 1.625470
## 2      0.086233                0               0               0 0.911606
##    V_TOTAL V_LEGUMES G_WHOLE G_REFINED  G_TOTAL PF_MEAT PF_CUREDMEAT PF_ORGAN
## 1 1.683470  0.660244       0  6.903612 6.903612  0.0000        7.569        0
## 2 0.997839  0.000000       0  9.312880 9.312880  2.7937        0.000        0
##   PF_POULT PF_SEAFD_HI PF_SEAFD_LOW PF_MPS_TOTAL PF_EGGS PF_SOY PF_NUTSDS
## 1        0           0            0       7.5690 0.00000      0         0
## 2        0           0            0       2.7937 2.39316      0         0
##   PF_LEGUMES PF_TOTAL D_MILK D_YOGURT D_CHEESE D_TOTAL     OILS SOLID_FATS
## 1   2.691764  7.56900 0.0000        0        0  0.0000 24.93141   35.37410
## 2   0.000000  5.18686 0.1122        0        0  0.1122  4.68600   57.96754
##   ADD_SUGARS A_DRINKS Day NoOfItems
## 1    3.20152    0.000   1        17
## 2   40.16171    6.336   1         8</code></pre>
</details>
<p><br></p>
</div>
<div id="b-3-calculate-the-mean-of-totalsparticipant" class="section level4">
<h4>B-3: Calculate the mean of totals/participant</h4>
<p>Calculate the mean of the two days of the totals data per participant.</p>
<pre class="r"><code>AverageTotalNHANES(food12d= food12d, 
                   first.val= &quot;GRMS&quot;, last.val= &quot;NoOfItems&quot;, 
                   outfn= &quot;eg_data/NHANES/Total_D12_FC_QC_mean.txt&quot;)  </code></pre>
<p>Load the mean totals.</p>
<pre class="r"><code>meantotal12b &lt;- read.table(&quot;eg_data/NHANES/Total_D12_FC_QC_mean.txt&quot;, sep=&quot;\t&quot;, header=T)</code></pre>
<p><br></p>
</div>
<div id="b-4-qc-the-mean-total-in-the-same-way-as-asa24." class="section level4">
<h4>B-4: QC the mean total in the same way as ASA24.</h4>
<p>For individual food data, there is no code for cleaning. Outliers won’t severely affect main analysis conclusions according to ASA24 data cleaning doc. However, it is always a good practice to take a look at the distributions of variables of interest. You can calculate totals by occasion, similarly to what we did with the ASA24 data.</p>
<p>For totals, the same QC can be applied as ASA24 totals QC procedure.</p>
<p>Run all these QC steps in this order. When asked, choose to remove the outliers that fall outside the specified range for each nutrient.</p>
<p>Define the input data. This dataframe will be modified after each filter.</p>
<pre class="r"><code>QCtotals &lt;- meantotal12b</code></pre>
<p>Flag if KCAL is &lt;600 or &gt;5700 → ask remove or not → if yes, remove those rows.</p>
<pre class="r"><code>QCOutliers(input.data = QCtotals, 
           target.colname = &quot;KCAL&quot;, min = 600, max = 5700)</code></pre>
<pre><code>## There are 42 observations with &lt; 600 or &gt; 5700 . 
## Remove? (Yes/no/cancel) 
## Outlier rows were removed; the cleaned data is saved as an object called &quot;QCtotals&quot;.
##  4359 rows remained.</code></pre>
<p>Flag if PROT is &lt;10 or &gt;240 → ask remove or not → if yes, remove those rows.</p>
<pre class="r"><code>QCOutliers(input.data = QCtotals, 
           target.colname = &quot;PROT&quot;, min = 10, max = 240)</code></pre>
<pre><code>## There are 8 observations with &lt; 10 or &gt; 240 . 
## Remove? (Yes/no/cancel) 
## Outlier rows were removed; the cleaned data is saved as an object called &quot;QCtotals&quot;.
##  4351 rows remained.</code></pre>
<p>Flag if TFAT is &lt;15 or &gt;230 → ask remove or not → if yes, remove those rows.</p>
<pre class="r"><code>QCOutliers(input.data = QCtotals, 
           target.colname = &quot;TFAT&quot;, min = 15, max = 230)</code></pre>
<pre><code>## There are 26 observations with &lt; 15 or &gt; 230 . 
## Remove? (Yes/no/cancel) 
## Outlier rows were removed; the cleaned data is saved as an object called &quot;QCtotals&quot;.
##  4325 rows remained.</code></pre>
<p>Flag if VC (Vitamin C) is &lt;5 or &gt;400 → ask remove or not → if yes, remove those rows.</p>
<pre class="r"><code>QCOutliers(input.data = QCtotals,  
           target.colname = &quot;VC&quot;, min = 5, max = 400)</code></pre>
<pre><code>## There are 118 observations with &lt; 5 or &gt; 400 . 
## Remove? (Yes/no/cancel) 
## Outlier rows were removed; the cleaned data is saved as an object called &quot;QCtotals&quot;.
##  4207 rows remained.</code></pre>
<p>or show the outliers if too many.</p>
<pre class="r"><code>  VCoutliers &lt;- Outlier_rows[, c(&#39;SEQN&#39;, &#39;KCAL&#39;, &#39;VC&#39;)]
  # Show the first n rows of the outliers in descending order. 
  head(VCoutliers[order(VCoutliers$VC, decreasing = T), ], n=10)</code></pre>
<pre><code>##       SEQN   KCAL     VC
## 4200 93251 2470.5 708.55
## 4320 93528 3243.5 702.30
## 3950 92689 1867.0 700.60
## 2823 90136 2368.0 666.45
## 3151 90904 2782.0 636.30
## 1332 86668 3325.5 626.55
## 2936 90404 3911.0 572.40
## 3656 92007 2968.0 569.60
## 1324 86652 3830.0 509.95
## 1058 86067 2885.5 501.15</code></pre>
<p>Look at how many rows (observations) were kept after QC.</p>
<pre class="r"><code>dim(QCtotals)</code></pre>
<pre><code>## [1] 4207  105</code></pre>
<hr />
<p>Save QCed total as a .txt file.</p>
<pre class="r"><code>write.table(QCtotals, &quot;eg_data/NHANES/Total_D12_FC_QC_mean_QC.txt&quot;, sep=&quot;\t&quot;, quote=F, row.names=F)</code></pre>
<p><br></p>
<hr />
<p>Add demograhic data to the QC-ed total.</p>
<p>Load the demographics file if you have not done so yet.</p>
<pre class="r"><code>demog &lt;- read.xport(&quot;eg_data/NHANES/Raw_data/DEMO_I.XPT&quot;)</code></pre>
<p>Merge QC-totals and demographics by SEQN.</p>
<pre class="r"><code>QCtotals_d &lt;- merge(x=QCtotals, y=demog, by=&quot;SEQN&quot;, all.x=TRUE)</code></pre>
<p>Save QCtotal_d as a .txt file.</p>
<pre class="r"><code>write.table(QCtotals_d, &quot;eg_data/NHANES/Total_D12_FC_QC_mean_QC_d.txt&quot;, sep=&quot;\t&quot;, quote=F, row.names=F)</code></pre>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
