<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Percent kcal of CARB, PROT, TFAT</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DietR Package</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    ASA24
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ASA24_1.html">Load and clean ASA24 data</a>
    </li>
    <li>
      <a href="ASA24_2.html">Calculate totals by occasion</a>
    </li>
    <li>
      <a href="ASA24_3.html">Data overview</a>
    </li>
    <li>
      <a href="ASA24_4.html">Percent kcal of CARB, PROT, TFAT</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="ASA24_5.html">Prepare for clustering</a>
    </li>
    <li>
      <a href="ASA24_6_PCA.html">PCA</a>
    </li>
    <li>
      <a href="ASA24_7_PCA_results.html">PCA results</a>
    </li>
    <li>
      <a href="ASA24_8_k-means.html">K-means</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="ASA24_9_create_food_tree.html">Create food tree</a>
    </li>
    <li>
      <a href="ASA24_10_viz_food_tree.html">Visualize food tree</a>
    </li>
    <li>
      <a href="ASA24_11_ordination.html">Ordination</a>
    </li>
    <li>
      <a href="ASA24_12_viz_ordination.html">Visualize ordination</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    NHANES
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="NHANES_1_load_and_clean_1.html">Load and clean NHANES data - 1</a>
    </li>
    <li>
      <a href="NHANES_2_load_and_clean_2.html">Load and clean NHANES data - 2</a>
    </li>
    <li>
      <a href="NHANES_3_data_overview.html">Data overview</a>
    </li>
    <li>
      <a href="NHANES_4_percent_kcal.html">Percent kcal of CARB, PROT, TFAT</a>
    </li>
  </ul>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Percent kcal of CARB, PROT, TFAT</h1>

</div>


<p>Name the path to DietR directory where input files are pulled.</p>
<pre class="r"><code>main_wd &lt;- &quot;~/GitHub/DietR&quot;</code></pre>
<p>Load the necessary functions.</p>
<pre class="r"><code>source(&quot;lib/specify_data_dir.R&quot;)
source(&quot;lib/ggplot2themes.R&quot;)
source(&quot;lib/percent_kcal.R&quot;)</code></pre>
<p>Call color palette.</p>
<pre class="r"><code>distinct100colors &lt;- readRDS(&quot;lib/distinct100colors.rda&quot;)</code></pre>
<p>You can come back to the main directory by:</p>
<pre class="r"><code>setwd(main_wd)</code></pre>
<p><br></p>
<div id="load-totals-data-with-demographics" class="section level3">
<h3>Load totals data with demographics</h3>
<p>Specify the directory where the data is.</p>
<pre class="r"><code>  SpecifyDataDirectory(directory.name= &quot;eg_data/NHANES/&quot;)</code></pre>
<!-- [NOTE] SpecifyDataDirectory function is not executed by R markdown, but just showing  -->
<!--  the code so that this tutorial will have the same code as the R script.  -->
<p>Load the totals with demographic data.</p>
<pre class="r"><code>totals &lt;- read.table(&quot;Total_D12_FC_QC_mean_QC_d.txt&quot;,  sep = &quot;\t&quot;, header = T)</code></pre>
<p>Totals has the mean dietary intake of two days for each participant and also their metadata. We are going to use the following columns in totals:</p>
<ul>
<li>RIAGENDR = gender</li>
<li>RIDAGEYR = age</li>
<li>CARB, PROT, TFAT, KCAL columns.</li>
</ul>
<p>Add gender and age_groups to totals. The output is named “totals_out”.</p>
<pre class="r"><code>AddGenderAgeGroups(input=totals, age.col=&quot;RIDAGEYR&quot;, gender.col=&quot;RIAGENDR&quot;)</code></pre>
<p>Ensure grouping has been done correctly.</p>
<pre class="r"><code>head(totals_out[, c(&quot;RIAGENDR&quot;, &quot;Gender&quot;, &quot;RIDAGEYR&quot;, &quot;AgeGroup&quot;, &quot;Gender_Age&quot;)])</code></pre>
<pre><code>##   RIAGENDR Gender RIDAGEYR AgeGroup Gender_Age
## 1        1      M       62      60s      M_60s
## 2        1      M       53      50s      M_50s
## 3        1      M       78  70s_80s  M_70s_80s
## 4        2      F       42      40s      F_40s
## 5        2      F       72  70s_80s  F_70s_80s
## 6        1      M       22      20s      M_20s</code></pre>
<p>Rename the output as totals to use in the following code.</p>
<pre class="r"><code>totals &lt;- totals_out</code></pre>
<p><br></p>
<hr />
</div>
<div id="calculate-and-visualize-kcal-of-carb-prot-and-tfat" class="section level3">
<h3>Calculate and visualize %kcal of CARB, PROT, and TFAT</h3>
<p>For NHANES, we will calculate the percentage of calories from each of the three macronutrients in the sum of calories from the three macronutrients. Thus, the percentage of calories from CARB, PROT, and TFAT will add up to 100.</p>
<div id="calculate-kcal-of-carb-prot-and-tfat" class="section level4">
<h4>Calculate %kcal of CARB, PROT, and TFAT</h4>
<p>Calculate the %kcal of CARB, PROT, and TFAT for each user and take means by Gender_Age.</p>
<pre class="r"><code>CPTpctKcalPerUser_NHANES(inputfn=totals, group=&#39;Gender_Age&#39;, across=&#39;SEQN&#39;, 
                         outfn=&quot;Total_D12_FC_QC_mean_QC_d_CPT_kcal.txt&quot;)</code></pre>
<p>Load the output.</p>
<pre class="r"><code>CPT_kcal &lt;- read.table(&quot;Total_D12_FC_QC_mean_QC_d_CPT_kcal.txt&quot;, sep=&quot;\t&quot;, header=T)</code></pre>
<p>CPT_kcal has Group, macronutrient, n, mean, and sd of each group.</p>
<pre class="r"><code>head(CPT_kcal)</code></pre>
<pre><code>##     Group macronutrient   n     mean       sd
## 1 F_18_19 CARB_kcal_pct  95 50.75217 8.581260
## 2   F_20s CARB_kcal_pct 346 48.07248 8.019404
## 3   F_30s CARB_kcal_pct 335 48.75215 8.094193
## 4   F_40s CARB_kcal_pct 383 49.31012 8.107403
## 5   F_50s CARB_kcal_pct 347 47.76785 8.173749
## 6   F_60s CARB_kcal_pct 365 48.73053 8.438459</code></pre>
<p><br></p>
</div>
<div id="plot-a-barchart-without-sd." class="section level4">
<h4>Plot a barchart without SD.</h4>
<p>Change the font size if necessary.<br />
This assumes that CPT_kcal has “Group” column.</p>
<pre class="r"><code>stacked_wo_SD &lt;- StackedwoSD_NHANES(data= CPT_kcal) + theme(axis.text.x=element_text(size=11))  </code></pre>
<pre class="r"><code>stacked_wo_SD</code></pre>
<p><img src="NHANES_4_percent_kcal_files/figure-html/unnamed-chunk-14-1.png" width="60%" /></p>
<p>Save as a .pdf.</p>
<pre class="r"><code>ggsave(&quot;Total_D12_FC_QC_mean_QC_d_CPT_kcal_wo_SD.pdf&quot;, stacked_wo_SD,
       device=&quot;pdf&quot;, width=6.2, height=4.2, units=&quot;in&quot;, dpi=300)</code></pre>
<p><br></p>
</div>
<div id="plot-the-dodge-type-of-barchart-3-bars-per-group-not-stacked" class="section level4">
<h4>Plot the “dodge”-type of barchart (3 bars per group, not stacked)</h4>
<p>Change the font size if necessary.</p>
<pre class="r"><code>dodgedtypebarchart &lt;- DodgedBarchart_NHANES(data= CPT_kcal) + theme(axis.text.x=element_text(size=11))</code></pre>
<pre class="r"><code>dodgedtypebarchart</code></pre>
<p><img src="NHANES_4_percent_kcal_files/figure-html/unnamed-chunk-17-1.png" width="60%" /></p>
<p>Save as a .pdf.</p>
<pre class="r"><code>ggsave(&quot;Total_D12_FC_QC_mean_QC_d_CPT_kcal_dodgedtypebarchart.pdf&quot;, dodgedtypebarchart,
       device=&quot;pdf&quot;, width=9.0, height=4, units=&quot;in&quot;, dpi=300)</code></pre>
<p><br></p>
</div>
<div id="using-cpt_kcal-create-a-stacked-barchart" class="section level4">
<h4>Using CPT_kcal, create a stacked barchart</h4>
<p>Create a vector that contains all the groups.</p>
<pre class="r"><code>groups &lt;- unique(CPT_kcal$Group)</code></pre>
<p>Calculate sd_base and sd_forstacked for stacked barchart. Note that this function assumes all groups have CARB, PROT, and TFAT values.</p>
<pre class="r"><code>CalcStackedSD_NHANES(input.df= CPT_kcal, out.fn= &quot;Total_D12_FC_QC_mean_QC_d_CPT_kcal_forstacked.txt&quot;)</code></pre>
<p>Load the saved file that has SD for stacked barchart.</p>
<pre class="r"><code>CPT_kcal_forstacked_read &lt;- read.table(&quot;Total_D12_FC_QC_mean_QC_d_CPT_kcal_forstacked.txt&quot;, sep=&quot;\t&quot;, header=T)</code></pre>
<p>Stacked barchart with SD as error bars.</p>
<pre class="r"><code>stacked_with_SD &lt;- StackedWithSD_NHANES(data= CPT_kcal_forstacked_read) + theme(axis.text.x=element_text(size=11))</code></pre>
<pre class="r"><code>stacked_with_SD</code></pre>
<p><img src="NHANES_4_percent_kcal_files/figure-html/unnamed-chunk-23-1.png" width="60%" /></p>
<p>Save as a .pdf.</p>
<pre class="r"><code>ggsave(&quot;Total_D12_FC_QC_mean_QC_d_CPT_kcal_with_SD.pdf&quot;, stacked_with_SD,
       device=&quot;pdf&quot;, width=6.2, height=4.3, units=&quot;in&quot;, dpi=300)</code></pre>
<p>Change the Y axis scale if necessary. Note that if the error bars of Carbohydrates disappear after changing the limits of Y axis, it may be because the error bars are higher than the max Y. Ensure you have enough max Y value to accommodate the error bars.</p>
<p>You can also change the breakpoints of the Y axis.</p>
<pre class="r"><code>stacked_with_SD + scale_y_continuous(breaks = c(0, 20, 40, 60, 80, 100))</code></pre>
<p><img src="NHANES_4_percent_kcal_files/figure-html/unnamed-chunk-25-1.png" width="60%" /></p>
<p><br></p>
<hr />
<p>Come back to the main directory.</p>
<pre class="r"><code>setwd(main_wd)</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
