---
title: "NHANES Data Overview"
output: html_document
---

Name the path to DietR directory where input files are pulled.
```{r}
  main_wd <- "~/GitHub/DietR"
```

Load the necessary packages.
```{r}
library(ggplot2)
```

Call color palette.
```{r}
distinct100colors <- readRDS("lib/distinct100colors.rda")
```

Load the necessary functions.
```{r}
  source("lib/specify_data_dir.R")
  source("lib/data_overview.R")
  source("lib/ggplot2themes.R")
```


You can come back to the main directory by:
```{r, eval=FALSE}
  setwd(main_wd)
```

<br>

## Load and analyze (QC-ed) NHANES food items data

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE)
knitr::opts_knit$set(root.dir = 'eg_data/NHANES')
```

Specify the directory where the data is.
```{r, eval = FALSE}
  SpecifyDataDirectory(directory.name= "eg_data/NHANES/")
```
<!-- [NOTE] SpecifyDataDirectory function is not executed by R markdown, but just showing  -->
<!--  the code so that this tutorial will have the same code as the R script.  -->

Load your items data to be analyzed.\
"_FC_cc_f_d" stands for: "Food category variables added", "column names changed", "food formatted", and "demographic data merged".
```{r}
food12f_d <- read.table("Food_D12_FC_cc_f_d.txt", sep="\t", header=T) 
```

<br>

### Summary statistics
  
#### Summary statistics of one variable

View min, quantiles, mean, etc. for a variable in your dataset.
```{r}
summary(food12f_d$KCAL)
```

<br>

#### Summary statistics of all the variables
Calculate the minimum, 1st quantile, median, mean, 3rd quantile, max, and standard deviation for each variable in the input dataframe and save as a .txt file.\
**[NOTE]** These are individual items, not by user or day. 
```{r}
SummaryStats(inputdf = food12f_d, 
             outfn = "Food_D12_FC_cc_f_d_summ.txt")
```

The first six rows of Food_D12_FC_cc_f_d_summ.txt looks like this. Summary statistics of some variables are not useful such as SEQN and Food_code, as they are not to be treated as continuous  variables.
```{r Food_summ_txt, echo=FALSE}
Food_D12_FC_cc_f_d_summ <- read.table("Food_D12_FC_cc_f_d_summ.txt", sep="\t", header=T)
head(Food_D12_FC_cc_f_d_summ)
```

<br>

### Boxplot

Generate a boxplot to view data distribution.

Group by metadata variables and generate a boxplot. According to [the documentation of the NHANES 2015-2016](https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DEMO_I.htm), the column for gender is RIAGENDR.   
Convert RIAGENDR into a factor, so that it will be a categorical variable.
```{r}
food12f_d$RIAGENDR <- factor(food12f_d$RIAGENDR, levels= c('1', '2'))
```

Generate a boxplot of KCAL by gender.
```{r}
gender_kcal <- ggplot(food12f_d, aes(x=RIAGENDR, y=KCAL, group=RIAGENDR)) +
  geom_boxplot() + no_grid + space_axes + labs(x="Gender") +
  scale_x_discrete(labels = c("Male", "Female")) 
```

```{r out.width="50%"}
gender_kcal
```


Save it as a .pdf file.
```{r}
ggsave("Food_D12_FC_cc_f_d_gender_kcal.pdf", 
       gender_kcal, device="pdf", width=5.3, height=4.5)
```

<br>

### Scatterplot
  
Scaterplot of two numeric variables: TFAT and KCAL.
```{r}
TFAT_KCAL <- ggplot(food12f_d, aes(x=TFAT, y=KCAL)) +
  geom_point() + no_grid + space_axes 
```

```{r out.width="50%"}
TFAT_KCAL
```

Save it as a .pdf file.
```{r}
ggsave("Food_D12_FC_cc_f_d_TFAT_KCAL.pdf", 
       TFAT_KCAL, device="pdf", width=5.3, height=4.5)
```

Test if the two variables are correlated. The output should show p-value and R correlation coefficient.
```{r}
cor.test(x=food12f_d$TFAT, y=food12f_d$KCAL, method="pearson")
```

<br>

## Load and analyze (QC-ed) NHANES totals data

Specify the directory where the data is, if you have not done so yet.
```{r, eval=FALSE}
SpecifyDataDirectory(directory.name = "eg_data/NHANES")  
```

Load your QC-ed totals with demograhpic data to be analyzed.
```{r}
QCtotals_d <- read.table("Total_D12_FC_QC_mean_QC_d.txt", sep="\t", header=T)
```

Note that each row is a total dietary intake of each user on each day.
```{r, eval=FALSE}
head(QCtotals_d, 2)
```

<details>
  <summary>Click to expand output</summary>
```{r, echo=FALSE, eval=TRUE}
head(QCtotals_d, 2)
```
</details>

<br>

### Summary statistics
  
Summary statistics of one variable
```{r}
summary(QCtotals_d$KCAL)
```

Calculate the min, quantiles, mean, etc. for a variable in your dataset in the same way we did with the items.
```{r}
SummaryStats(inputdf = QCtotals_d, 
             outfn = "Total_D12_FC_QC_mean_QC_d_summ.txt")
```

The first six rows of Total_D12_FC_QC_mean_QC_d_summ.txt looks like this.
```{r Total_summ_txt, echo=FALSE}
Total_D12_FC_QC_mean_QC_d_summ <- read.table("Total_D12_FC_QC_mean_QC_d_summ.txt", sep="\t", header=T)
head(Total_D12_FC_QC_mean_QC_d_summ)
```

<br>

### Boxplot

Generate a boxplot to view data distribution.

Convert RIAGENDR into a factor, so that it will be a categorical variable.
```{r}
QCtotals_d$RIAGENDR <- factor(QCtotals_d$RIAGENDR, levels= c('1', '2'))
```

Boxplot of KCAL by gender (RIAGENDR). "t" stands for "total".
```{r}
gender_KCAL_t <- ggplot(QCtotals_d, aes(x= RIAGENDR, y=KCAL)) +
  geom_boxplot() + no_grid + space_axes + labs(x="Gender") +
  scale_x_discrete(labels = c("Male", "Female"))
```

```{r out.width="50%"}
gender_KCAL_t
```
  
Save it as a .pdf file.
```{r}
ggsave("Total_D12_FC_QC_mean_QC_d_gender_KCAL.pdf", 
       gender_KCAL_t, device="pdf", width=5.3, height=4.5)
```

Boxplot of KCAL by gender, with each datapoint.  Note that geom_boxplot must have `outlier.shape = NA` when plotted with geom_jitter. Otherwise, outlier points will be duplicated and will be misleading.

```{r}
gender_KCAL_t_dots <- ggplot(QCtotals_d, aes(x= RIAGENDR, y= KCAL)) +
  geom_boxplot(outlier.shape = NA) + no_grid + space_axes + labs(x="Gender") +
  geom_jitter(width=0.3, color="grey60", alpha=0.5) +
  scale_x_discrete(labels = c("Male", "Female"))
```

```{r out.width="50%"}
gender_KCAL_t_dots
```
  
Save it as a .pdf file.
```{r}
ggsave("Total_D12_FC_QC_mean_QC_d_KCAL_dots.pdf", 
       gender_KCAL_t_dots, device="pdf", width=5.3, height=4.5)
```

<br>

### Scatterplot
  
Scaterplot of two variables.
```{r}
TFAT_KCAL_t <- ggplot(QCtotals_d, aes(x=TFAT, y=KCAL)) +
  geom_point(color="grey30", alpha=0.5) + no_grid + space_axes
```

```{r out.width="50%"}
TFAT_KCAL_t
```  

Save it as a .pdf file.
```{r}
ggsave("Total_D12_FC_QC_mean_QC_d_TFAT_KCAL.pdf", 
       TFAT_KCAL_t, device="pdf", width=5.3, height=4.5)
```

Test if the two variables are correlated. The output should show p-value and R correlation coefficient.
```{r}
cor.test(x=QCtotals_d$TFAT, y=QCtotals_d$KCAL, method="pearson")
```

<br>

--- 

Come back to the main directory.
```{r, eval=FALSE}
setwd(main_wd)
```

  
